\section{Оповещения об ошибках}\label{ALERT.Err}

Если сторона TLS сталкивается с ошибкой, то ей следует отправить 
противоположной стороне соответствующее оповещение. После этого сторона должна  
закрыть соединение, прекратив отправку и прием данных.
%
В настоящем стандарте фразы <<закрыть соединение с оповещением~X>> и <<прервать 
Handshake с оповещением~X>> означают, что если сторона отправляет оповещение,
то это должно быть оповещение~X.

Определены следующие оповещения об ошибках:

\begin{itemize}
\item\label{ALERT.Err.um}
\code{unexpected_message}~--- получено некорректное сообщение. Оповещение 
никогда не появится при штатном выполнении TLS;

\item\label{ALERT.Err.brm}
\code{bad_record_mac}~--- ошибка при снятии защиты с записи. 
%
Оповещение никогда не появится при штатном выполнении TLS, если только запись 
не была повреждена во время передачи;

\item\label{ALERT.Err.ro}
\code{record_overflow}~--- получена либо защищенная запись 
\lstinline{TLSCiphertext}, размер которой больше $2^{14} + 256$ байтов,
либо открытая запись \lstinline{TLSPlaintext}, размер которой больше $2^{14}$ 
байтов. Максимальные размеры могут уменьшаться по предварительному согласованию 
сторон, например, с помощью расширения~\token[HS.Ext.mfl]{max_fragment_length}.
%
Оповещение никогда не появится при штатном выполнении TLS, если только запись
не была повреждена во время передачи;

% diff: в [RFC8446] речь одет о расширении `record_size_limit` из [RFC8449]

\item\label{ALERT.Err.hf}
\code{handshake_failure}~--- ни один из предложенных наборов параметров защиты 
не устраивает отправителя оповещения; 

\item\label{ALERT.Err.bc}
\code{bad_certificate}~--- сертификат поврежден, содержит некорректную ЭЦП 
и т.~д.;  

\item\label{ALERT.Err.uc}
\code{unsupported_certificate}~--- сертификат данного типа не поддерживается;

\item\label{ALERT.Err.cr}
\code{certificate_revoked}~--- сертификат отозван выпустившей его стороной;

\item\label{ALERT.Err.ce}
\code{certificate_expired}~--- срок действия сертификата истек 
или еще не наступил;

\item\label{ALERT.Err.cu}
\code{certificate_unknown}~--- сертификат нельзя использовать из-за ошибки,
которой нет среди перечисленных выше;

\item\label{ALERT.Err.ip}
\code{illegal_parameter}~--- в сообщении Handshake одно из полей лежит вне 
допустимого диапазона или не согласуется с другими полями. Оповещение 
касается сообщений, которые имеют корректный формат, но некорректное 
содержание; 

\item\label{ALERT.Err.uca}
\code{unknown_ca}~--- получена корректная цепочка сертификатов или ее часть, но
сертификат не был признан действительным, поскольку сертификат удостоверяющего
центра не был найден или не соответствует известным точкам доверия;

\item\label{ALERT.Err.ad}
\code{access_denied}~--- получен действительный сертификат или PSK, 
но после проверки прав доступа отправитель оповещения решил не продолжать; 

\item\label{ALERT.Err.de}
\code{decode_error}~--- сообщение не может быть декодировано, так как одно из
полей лежит вне допустимого диапазона или длина сообщения некорректна.
Оповещение касается сообщений некорректного формата.
%
Оповещение никогда не появится при штатном выполнении TLS, если только 
сообщение не было повреждено во время передачи;

\item\label{ALERT.Err.de2}
\code{decrypt_error}~--- 
неудачное завершение криптографической операции во время выполнения Handshake, 
в том числе отрицательный вердикт при проверке ЭЦП, сообщения 
\token[HS.F]{Finished} или PSK-скрепки;

\item\label{ALERT.Err.pv}
\code{protocol_version}~--- версия протокола, предложенная противоположной 
стороной при согласовании параметров защиты, не поддерживается;

\item\label{ALERT.Err.is}
\code{insufficient_security}~--- используется вместо 
\token[ALERT.Err.hf]{handshake_failure} в тех случаях, когда процесс 
согласования параметров защиты завершился неудачно из-за того, что сервер 
запросил более высокий уровень защиты, чем тот, который поддерживает клиент;

\item\label{ALERT.Err.ie}
\code{internal_error}~--- внутренняя ошибка, которая не связана с 
противоположной стороной или логикой протокола (например, ошибка  
выделения памяти) и которая делает невозможным продолжение протокола;

\item\label{ALERT.Err.if}
\code{inappropriate_fallback}~--- высылается сервером в рамках механизма 
{TLS\_FALLBACK\_SCSV} (см.~\cite{RFC7507}) в ответ на некорректную повторную 
попытку подключения со стороны клиента;

\item\label{ALERT.Err.me}
\code{missing_extension}~--- согласованная версия TLS или другие параметры 
защиты предполагают включение в сообщение Handshake определенного расширения,
но это расширение отсутствует;

\item\label{ALERT.Err.ue}
\code{unsupported_extension}~--- сообщение \token[HS.SH]{ServerHello} или 
\token[HS.F]{Finished} содержит расширение, которое не было включено  
в предшествующее сообщение \token[HS.CH]{ClientHello} или 
\token[HS.CR]{CertificateRequest};

% use: https://www.rfc-editor.org/errata/eid6820

\item\label{ALERT.Err.un}
\code{unrecognized_name}~--- сервер, указанный клиентом в расширении 
\token[HS.Ext.sn]{server_name}, не найден;

\item\label{ALERT.Err.bcsr}
\code{bad_certificate_status_response}~--- клиент сообщает серверу, что 
в расширении \token[HS.Ext.sr]{status_request} содержится недействительный или 
неприемлемый ответ OCSP;

\item\label{ALERT.Err.upi}
\code{unknown_psk_identity}~--- сервер сообщает клиенту, что он не может 
определить предварительно согласованный секрет по идентификатору.
%
Для информирования клиента серверу не обязательно использовать оповещение 
\code{unknown_psk_identity}. Вместо него сервер может использовать 
\token[ALERT.Err.de]{decrypt_error};

\item\label{ALERT.Err.cr2}
\code{certificate_required}~--- сервер сообщает клиенту, что тот должен был 
представить сертификат, но не сделал этого; 

\item\label{ALERT.Err.nap}
\code{no_application_protocol}~--- ни один из прикладных протоколов, указанных 
клиентом в расширении 
\token[HS.Ext.alpn]{application_layer_protocol_negotiation}, не поддерживается 
сервером.
\end{itemize}

Все перечисленные оповещения, а также любое неизвестное оповещение являются критическими. 
%
В реализациях TLS следует предусматривать ведение журнала отправляемых и 
получаемых оповещений.
